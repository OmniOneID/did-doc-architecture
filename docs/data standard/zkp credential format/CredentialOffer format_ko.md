---
puppeteer:
    pdf:
        format: A4
        displayHeaderFooter: true
        landscape: false
        scale: 0.8
        margin:
            top: 1.2cm
            right: 1cm
            bottom: 1cm
            left: 1cm
    image:
        quality: 100
        fullPage: false
---

Credential Offer format
==

- 주제
    - ZKP Credential Offer 구조 정의
- 작성: 박동준
- 일자: 2025-04-30
- 버전: v1.0.0

개정이력
---

| 버전   | 일자       | 변경 내용 |
| ------ | ---------- | --------- |
| v1.0.0 | 2025-04-30 | 초안      |


<div style="page-break-after: always;"></div>

---

<!-- TOC tocDepth:2..4 chapterDepth:2..6 -->

- [Credential Offer format](#credential-offer-format)
  - [개정이력](#개정이력)
  - [1. 개요](#1-개요)
    - [1.1. 참조문서](#11-참조문서)
  - [2. CredentialOffer 구조](#2-credentialoffer-구조)
  - [3. 예시](#3-예시)
    - [3.1. 운전면허증 CredentialOffer](#31-운전면허증-credentialoffer)

<!-- /TOC -->

<div style="page-break-after: always;"></div>


## 1. 개요

본 문서는 OpenDID ZKP에서 사용하는 CredentialOffer의 구조와 관련 정보를 정의한다.

발급자가 자격증명(credential)을 발행하기 전에 세부 정보와 조건을 지정하는데 사용된다. CredentialOffer를 생성하면 자격증명 소유자는 이를 확인하고 자격증명을 요청할 수 있다.
CredentialOffer는 다음의 정보를 포함한다.

- nonce, credential schema id, credential definition id
- 키 정확성 증명 값 xz_cap, xr_cap(master_secret을 포함한 어트리뷰트의 공개키)

본 문서는 Credential Offer를 정의하기 위한 문서 형식인 Credential Offer format을 정의하는 것을 목적으로 한다.
format은 모두 OSD (OpenDID Schema Definition Language)로 정의한다.

### 1.1. 참조문서

| 참조명                      | 문서명                                          | 위치 |
| ------------------------- | ----------------------------------------------- | ---- |
| [OSD]                     | OpenDID Schema Definition Language              |      |
| [ZKP-DATA-SPEC]           | (OpenDID) 데이터 명세서(ZKP Data Specification)    |      |
| [CREDENTIAL-OFFER-FORMAT] | (OpenDID) Credential Offer format               |      |


<div style="page-break-after: always;"></div>

## 2. CredentialOffer 구조

여기에 정의되지 않은 항목은 `[ZKP-DATA-SPEC]`을 참조한다.

`CredentialOffer`는 Credential Offer object이다.

```c#
def object CredentialOffer: "credential offer"
{    
    + nonce "nonce"                      : "난수 값"
    + schema-identifier "schemaId"       : "CredentialSchema의 ID"
    + definition-identifier "credDefId"  : "CredentialDefinition의 ID"
    + object "keyCorrectnessProof"       : "KeyCorrectnessProof, "
}
```

- `~/nonce`: 재사용 공격을 방지하기 위해 사용되는 난수 값 (Credential Request와 연관)
- `~/schemaId`: 증명서(Credential)의 데이터 구조(스키마)를 정의하는 ID
- `~/credDefId`: 발급자가 특정 스키마에 대해 생성한 증명서 정의(Credential Definition)의 ID, Credential Definition은 해당증명서가 어떤 서명키로 발급되었는지 나타내며 검증자가 이를 이용하여 증명서의 유효성을 검증함
- `~/keyCorrectnessProof`: 발급자가 올바른 공개 키를 사용했을을 보장하는 증명값, 증명서 요청 단계에서 Holder가 발급자의 공개키가 올바른지 확인하기 위함

<div style="page-break-after: always;"></div>

## 3. 예시

본 장에서는 CredentialOffer의 이해를 돕기 위해 구체적인 예를 들어 추가로 설명한다.
상황은 다음과 같다.

- 이슈어가 사용자에게 "운전면허증 Credential"를 발급하기 위한 Offer를 생성한다.
- 운전면허증 Credential 내 어트리뷰트는 아래 목록과 같이 하기로 결정하였다.
    - 성별, 생년월일, 면허번호, 주소
- 상기 어트리뷰트를 OpenDID Credential Offer format에 맞춰 JSON으로 작성한다.

### 3.1. 운전면허증 CredentialOffer

예시)
```json
{
  "nonce": "1068995366822249097155600",
  "schemaId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0",
  "credDefId": "did:omn:NcYxiDXkpYi6ov5FcYDi1e:3:CL:did:omn:NcYxiDXkpYi6ov5FcYDi1e:2:mdl:1.0:Tag1",
  "keyCorrectnessProof": {
    "c": "61980984485776724933402455877937134233912022625919280439072090002286297246205",
    "xzCap": "1080982125825430807259065529990702292068266143247776505250825808893796780508006302461979879750998738524977383348028693249690619722763832303067179908656232148988773584921802105449249469059523516998594671219147387340747638921987114926318990463234581145129781762923730122759544733961403947282715983031223120226973860859566122622844407724692516124883307465463354410192548228153990283554608328590976831408804668980558986220216879897579763454769860300542882682420369489235562872729184093881963903014342723108609093148640399475072071283914539421118386002612997159202131678694492129942010208145660698805541072007508397357695759592010043462863050191910590483507026652896780169043696229629657540108393850",
    "xrCap": {
      "zkpsex": "453315053885889758264853899514340139070319054651047595276876576236954133950565568793103313572704031121131199327941231605294389109379865076285774149943073238849524645566039227826376426881220814352262280963045140428071897033801201769308095464423709138528667316199702095217136682052904432973007205298534655676842260139064967523250976295389463573238301179884547556588492474299515158361503607157294991437962831303404709304757928508189927338324971100328078851271338630240570260104746193457386442477828616729928314858861489337330559522175931488023624450852976981406850595384441247541180574206761480138650365739579212785384429858480883024882900569945728919511101376435795106877347024992633381767935106",
      "zkpasort": "1559374196102239112996086609998417758774864392034104024611710807412113880306550065006210037545045435172347314592350842876923504240520480000624670412209447859946856328878756418467899345615401924426881712003102206831098279079505583809393580067936636596818211179529733298913714547253948776211745793146010290502618162086456148695462986300393436080932825592193328973675835057712116179437496747821941104923373933420140678599361470928725148856698839710841801826731737130398945201709140513552428910342844440749398783133861087720581105321446044675674889317046685374457077222044512797850144005540373450688789856084480738129818681354020794461286673904996707500685427022061321476656605919180628287423572862",
      "zkpaddr": "726253198208045090254556102082970092649451712552572589552992428681248536645657001701507913560136313268490234824497440908205718864989516053970722629437041682265033319668769558481496818814512733711465642559611416901382463337052436507101909714449060060547649877577638066286922181046537687863511231607929759091767988228263439503463740074183881490403140603003986346567002224154819599035614855102949849162745294587759397329670937542882122018722747797487004795426580874006820997234484937994446001550460780597460994353953971134693347305553297682718135306751852728782114076889820984358135621444859391832226500721219282073307533145344952595738168633367565476998865574675830971421015481686884468220981185",
      "zkpbirth": "1870550632554202034806900688402537667268497525770442014498858022041370659186342958547337062142686222939194843553907104484473365287547937580582074977680287278719860704630004335321438519431623525703512827873090963798480289879080911091623004069475376748360679253485684078664069780833055362435777889557869410433106044105708970845612853475431021366376512052649908243886053636585638739906366733427230614000714902841474549024995783709530016310657186317970153943219714870044800154964985306920998012648518128292410538937295593881965885759134582756528926963604341997078739475861899920908809846490801683104462243511134559883018208419473906991334095206485219328723817787869080894017024410317476434931570442",
      "masterSecret": "211844056143484669903438558522435598501676557003496654495224135577983882263044224130919351504808633055047351886609650676589684221497753409312067522989019064637219363492354204355049866527455494351865595046512655156032786647929879861924179409204898712111291876587357059783426586226902643151855055800815474388451371832360250950530296085790056234517803076109112764536622661438531127307304080961753941701993078551723576225034170292931806106568841378471901579434337670126205674836693310260151684529560668771849271249013453494254957650241488067019064003723795604440568012524302336055017805864718860753421387898826741381068862180479286951500423932603611478809189633621668712358030463381617443777577206"
    }
  }
}
```



